import json
import random
import time
import psycopg2
import itertools
import datetime

def dt_to_epoch(d):
	return (d-datetime.datetime(1970,1,1)).total_seconds()

def get_data(id):
	
	if id[-1] == 'a': offset = 0
	elif id[-1] == 'b': offset = 1
	else: return []
	
	query = "SELECT mac FROM device WHERE id="+id[:-1]+";"
	
	conn = psycopg2.connect(database = 'wattson', host = 'localhost', user = 'root', password = 'means swim of stream')
	cur = conn.cursor()
	
	cur.execute(query)
	
	devs = cur.fetchone()
	data = devs[0]
	
	# query = "SELECT til,v_1,v_2,i_1,i_2,p_1,p_2,f FROM sample WHERE device_mac='"+data+"' AND til > now() - interval '2 hour' ORDER BY til DESC;"
	query = "SELECT til,v_1,v_2,i_1,i_2,p_1,p_2,f FROM sample WHERE device_mac='"+data+"' ORDER BY til DESC LIMIT 1000;"
	
	cur.execute(query)
	
	devs = cur.fetchall()
	v_arr = []
	i_arr = []
	p_arr = []
	
	for d in devs:
		epoch = dt_to_epoch(d[0])
		v_arr.append([epoch, round(float(d[1+offset]),2)])
		i_arr.append([epoch, round(float(d[3+offset]),2)])
		p_arr.append([epoch, round(float(d[5+offset]),2)])
	
	cur.close()
	conn.close()
	
	# return [v_arr,i_arr,p_arr]
	return [v_arr,p_arr]
	
def get_devices():
	# {"name1":"Foo","id1":1,"name2":"Bar","id2":2}
	
	query = "SELECT * FROM device;"
	
	conn = psycopg2.connect(database = 'wattson', host = 'localhost', user = 'root', password = 'means swim of stream')
	cur = conn.cursor()
	
	cur.execute(query)
	
	devs = cur.fetchall()
	
	data = []
	
	for d in devs:
		data.append({"name1": str(d[2]), "id1": str(d[0])+"a", "name2": str(d[3]), "id2": str(d[0])+"b", "mac": d[4]})	
	cur.close()
	conn.close()
	
	return data

str_out = '''[[[1393898556112, 120], [1393898574112, 119.98136851464693], [1393898592112, 120.11238299124685], [1393898610112, 120.00652996513537], [1393898628112, 119.84625467139011], [1393898646112, 120.03341758571274], [1393898664112, 120.22897601974589], [1393898682112, 120.34452116155879], [1393898700112, 120.30163934351937], [1393898718112, 120.48992612074807], [1393898736112, 120.40589555887622], [1393898754112, 120.55237011884823], [1393898772112, 120.61494080912182], [1393898790112, 120.50498389020947], [1393898808112, 120.6307372704904], [1393898826112, 120.59199551120335], [1393898844112, 120.5743597264315], [1393898862112, 120.46098494220021], [1393898880112, 120.47330562537013], [1393898898112, 120.23118734802186], [1393898916112, 120.40659878389161], [1393898934112, 120.31768557582356], [1393898952112, 120.56663443025695], [1393898970112, 120.70026555070682], [1393898988112, 120.66611338198109], [1393899006112, 120.83383317198701], [1393899024112, 121.00081345149012], [1393899042112, 120.77859180576465], [1393899060112, 120.78284673832047], [1393899078112, 120.83418101746756], [1393899096112, 121.03298984731367], [1393899114112, 120.95354043088282], [1393899132112, 121.07642013351536], [1393899150112, 120.89978558370905], [1393899168112, 121.08465385824748], [1393899186112, 121.03275182047956], [1393899204112, 121.11182498786691], [1393899222112, 120.89749704465785], [1393899240112, 121.05418061287584], [1393899258112, 121.24526857438345], [1393899276112, 121.00718848739889], [1393899294112, 120.88842275559581], [1393899312112, 120.96582846964465], [1393899330112, 121.09582071886877], [1393899348112, 120.98309608282749], [1393899366112, 120.93311068414918], [1393899384112, 120.80947426916877], [1393899402112, 120.75278506332823], [1393899420112, 120.51959078563479], [1393899438112, 120.33947641312389], [1393899456112, 120.24363704213907], [1393899474112, 120.08951921171354], [1393899492112, 119.8495217548987], [1393899510112, 119.76647105426788], [1393899528112, 119.87415701525363], [1393899546112, 119.76030603878425], [1393899564112, 119.76159640876145], [1393899582112, 119.69923790942411], [1393899600112, 119.64677485402838], [1393899618112, 119.41205825660117], [1393899636112, 119.26363085042462], [1393899654112, 119.21029296035643], [1393899672112, 119.00583998428395], [1393899690112, 118.79906681496584], [1393899708112, 118.63441065320615], [1393899726112, 118.46872221220266], [1393899744112, 118.65926423110815], [1393899762112, 118.41059313690202], [1393899780112, 118.40488321347539], [1393899798112, 118.3515074119737], [1393899816112, 118.2938435252082], [1393899834112, 118.42514866961687], [1393899852112, 118.35758383424971], [1393899870112, 118.55685829039929], [1393899888112, 118.33917290678745], [1393899906112, 118.34121597232108], [1393899924112, 118.56204726044513], [1393899942112, 118.49599279871079], [1393899960112, 118.58362006009045], [1393899978112, 118.43514226255218], [1393899996112, 118.50978836200193], [1393900014112, 118.68676067923349], [1393900032112, 118.65994797930146], [1393900050112, 118.61953143958354], [1393900068112, 118.49638404691257], [1393900086112, 118.71449406502941], [1393900104112, 118.61348822791723], [1393900122112, 118.83379763053514], [1393900140112, 118.8620870765253], [1393900158112, 118.97081056544283], [1393900176112, 119.07280424374399], [1393900194112, 118.88531408676441], [1393900212112, 119.01497296866924], [1393900230112, 119.11542260592181], [1393900248112, 119.03041610741431], [1393900266112, 119.14410492446143], [1393900284112, 119.06249879071564], [1393900302112, 119.24545333174994], [1393900320112, 119.38443681412322], [1393900338112, 119.54516395582624], [1393900356112, 119.58467229813559], [1393900374112, 119.75362945572829], [1393900392112, 119.88701311331162], [1393900410112, 120.0563058395369], [1393900428112, 119.90335314929284], [1393900446112, 119.96017161393813], [1393900464112, 119.8305780040851], [1393900482112, 119.70680926954638], [1393900500112, 119.78564666583074], [1393900518112, 119.69599866707274], [1393900536112, 119.59250833755925], [1393900554112, 119.35232201818421], [1393900572112, 119.124125087121], [1393900590112, 119.06992874330756], [1393900608112, 119.18492530729982], [1393900626112, 119.09181009911973], [1393900644112, 119.22682198898417], [1393900662112, 119.21920382934987], [1393900680112, 119.07257848604304], [1393900698112, 118.90963434297298], [1393900716112, 119.07008603341576], [1393900734112, 119.1876671286102], [1393900752112, 119.05036371568978], [1393900770112, 118.96656630000916], [1393900788112, 119.15093653940889], [1393900806112, 118.95382677625348], [1393900824112, 119.17788098106892], [1393900842112, 119.33470381156384], [1393900860112, 119.53014005169376], [1393900878112, 119.67086587070243], [1393900896112, 119.66495757981765], [1393900914112, 119.58603239591197], [1393900932112, 119.77899768880808], [1393900950112, 119.89028672678025], [1393900968112, 120.13094942616561], [1393900986112, 119.98367547661229], [1393901004112, 119.84309696009565], [1393901022112, 119.92482118842958], [1393901040112, 120.14432485938798], [1393901058112, 120.21251882059052], [1393901076112, 120.32059387059441], [1393901094112, 120.23554564893264], [1393901112112, 120.20237490579116], [1393901130112, 120.41969820068455], [1393901148112, 120.51240527540176], [1393901166112, 120.31863811051304], [1393901184112, 120.12514222601784], [1393901202112, 120.06846801676222], [1393901220112, 119.9753696169754], [1393901238112, 119.79284577752128], [1393901256112, 119.92269402623361], [1393901274112, 120.09738895182801], [1393901292112, 120.27122067386883], [1393901310112, 120.1224179708423], [1393901328112, 119.97276261142187], [1393901346112, 119.77808409926172], [1393901364112, 119.65662854745615], [1393901382112, 119.5480007564274], [1393901400112, 119.52553565902255], [1393901418112, 119.70160300817335], [1393901436112, 119.58339370688469], [1393901454112, 119.59145027721274], [1393901472112, 119.69224266432296], [1393901490112, 119.83042358614728], [1393901508112, 119.8045577431658], [1393901526112, 120.00604616422025], [1393901544112, 120.23087645366336], [1393901562112, 120.43493896457606], [1393901580112, 120.18538811951593], [1393901598112, 120.34664455015697], [1393901616112, 120.51253854111302], [1393901634112, 120.66008856208829], [1393901652112, 120.78836818641516], [1393901670112, 120.590766971128], [1393901688112, 120.7543395904326], [1393901706112, 120.65656015677644], [1393901724112, 120.52742089652722], [1393901742112, 120.73829369642777], [1393901760112, 120.98708104098586], [1393901778112, 120.85367950942624], [1393901796112, 120.83596107639777], [1393901814112, 120.9197113983627], [1393901832112, 121.09272292759103], [1393901850112, 121.0288029372151], [1393901868112, 121.2718528811182], [1393901886112, 121.23771238155528], [1393901904112, 121.45115223874316], [1393901922112, 121.28710029425851], [1393901940112, 121.3382862963964], [1393901958112, 121.4202634764777], [1393901976112, 121.40439966151023], [1393901994112, 121.61084916189944], [1393902012112, 121.56424513231472], [1393902030112, 121.67101667675573], [1393902048112, 121.85877002760223], [1393902066112, 121.80006274022907], [1393902084112, 121.77539600250813], [1393902102112, 121.7008989994963], [1393902120112, 121.70895642607924], [1393902138112, 121.48596680830552], [1393902156112, 121.53823058456167]], [[1393898556112, 0], [1393898574112, 0], [1393898592112, 0.04757987397955804], [1393898610112, 0], [1393898628112, 0], [1393898646112, 0.10814818308071988], [1393898664112, 0], [1393898682112, 0.05938362147519277], [1393898700112, 0.07922866320780025], [1393898718112, 0.12197664507774225], [1393898736112, 0], [1393898754112, 0.11776199439396667], [1393898772112, 0.1645589633367348], [1393898790112, 0.3116986736104561], [1393898808112, 0.46156053884888737], [1393898826112, 0.24173721404543125], [1393898844112, 0.0014243699049437675], [1393898862112, 0.2136523572560785], [1393898880112, 0.18539086235190871], [1393898898112, 0.29015627271334643], [1393898916112, 0.28536883428537574], [1393898934112, 0.125647098267476], [1393898952112, 0], [1393898970112, 0.19952518080029874], [1393898988112, 0.003333029958257794], [1393899006112, 0.12346300294721163], [1393899024112, 0], [1393899042112, 0.02035337087928063], [1393899060112, 0], [1393899078112, 0], [1393899096112, 0.13474980958399901], [1393899114112, 0.14578005050693876], [1393899132112, 0.17167975470018526], [1393899150112, 0.043239228482816916], [1393899168112, 0], [1393899186112, 0.07252311912676584], [1393899204112, 0.1994456676444314], [1393899222112, 0.3694609427669489], [1393899240112, 0.6112841854130373], [1393899258112, 0.38859189753599505], [1393899276112, 0.2570088989705082], [1393899294112, 0.2698351360574533], [1393899312112, 0.4307555549912717], [1393899330112, 0.3279473674840164], [1393899348112, 0.5337837601574762], [1393899366112, 0.7686036491008845], [1393899384112, 0.9368596264338439], [1393899402112, 0.7084558039021829], [1393899420112, 0.9232093091174538], [1393899438112, 0.8410493180270151], [1393899456112, 0.7039010303721731], [1393899474112, 0.6475212980355773], [1393899492112, 0.44115107183588476], [1393899510112, 0.46566572855790717], [1393899528112, 0.6999244201628305], [1393899546112, 0.934202228452068], [1393899564112, 0.8880261018498194], [1393899582112, 1.0540488623967095], [1393899600112, 0.9292567739667561], [1393899618112, 1.173877610872001], [1393899636112, 1.413961188620299], [1393899654112, 1.2643237905942137], [1393899672112, 1.1641912761208768], [1393899690112, 1.1847263826189194], [1393899708112, 1.2743182044908226], [1393899726112, 1.1568040033531815], [1393899744112, 1.2149020927781833], [1393899762112, 1.3175576685097348], [1393899780112, 1.5532083665857566], [1393899798112, 1.4839778198531164], [1393899816112, 1.515966056721937], [1393899834112, 1.5625890131751068], [1393899852112, 1.7763444839522027], [1393899870112, 1.5690901992065787], [1393899888112, 1.6636325445370352], [1393899906112, 1.675480683167949], [1393899924112, 1.883243312860664], [1393899942112, 1.8397887625817697], [1393899960112, 1.9037622767558562], [1393899978112, 2.123353075958491], [1393899996112, 2.2826702702474853], [1393900014112, 2.2696592926572956], [1393900032112, 2.369891070733859], [1393900050112, 2.615783753165592], [1393900068112, 2.4593100595331743], [1393900086112, 2.395924252758539], [1393900104112, 2.515672154466303], [1393900122112, 2.747277924035363], [1393900140112, 2.6373127876248152], [1393900158112, 2.4434427602628794], [1393900176112, 2.5776793529317574], [1393900194112, 2.484849526376152], [1393900212112, 2.3485020911202725], [1393900230112, 2.350230823605559], [1393900248112, 2.488583318071222], [1393900266112, 2.441525231776491], [1393900284112, 2.2892751020500817], [1393900302112, 2.1098498431146218], [1393900320112, 2.357762443839798], [1393900338112, 2.3313584517850874], [1393900356112, 2.5704107259017936], [1393900374112, 2.40149077719599], [1393900392112, 2.26409561955701], [1393900410112, 2.1179389769438557], [1393900428112, 2.1014992246524624], [1393900446112, 2.211340091523845], [1393900464112, 2.427429264951308], [1393900482112, 2.5871879168636776], [1393900500112, 2.511142012517606], [1393900518112, 2.420339397914523], [1393900536112, 2.4259462902289775], [1393900554112, 2.5048421608201745], [1393900572112, 2.341001164808352], [1393900590112, 2.3965964324982814], [1393900608112, 2.426540791609988], [1393900626112, 2.4604925739443773], [1393900644112, 2.2289503788215237], [1393900662112, 2.4333752623659555], [1393900680112, 2.330478669719647], [1393900698112, 2.1559751107333485], [1393900716112, 2.002614858205312], [1393900734112, 2.012962283392431], [1393900752112, 2.1218769616024336], [1393900770112, 2.2583081126874194], [1393900788112, 2.027924642267387], [1393900806112, 1.8531714313742935], [1393900824112, 1.9259239060624183], [1393900842112, 2.0621470571801312], [1393900860112, 2.233657050968151], [1393900878112, 2.216611615530442], [1393900896112, 2.1523241757904135], [1393900914112, 2.3094432300599634], [1393900932112, 2.294317583101516], [1393900950112, 2.340473606276566], [1393900968112, 2.1375815524811888], [1393900986112, 1.9117769870466943], [1393901004112, 2.0711989934693387], [1393901022112, 1.9416431867177], [1393901040112, 1.9572332266515493], [1393901058112, 1.8694510412294179], [1393901076112, 1.8290598449229993], [1393901094112, 1.7144189508287981], [1393901112112, 1.7486846875109108], [1393901130112, 1.862866232723185], [1393901148112, 1.771762311479941], [1393901166112, 1.9348153358655866], [1393901184112, 2.143444642972316], [1393901202112, 2.1162085086860314], [1393901220112, 2.194078486047287], [1393901238112, 2.3898394806775847], [1393901256112, 2.2230048200773385], [1393901274112, 2.0484412906656155], [1393901292112, 2.025220609052873], [1393901310112, 2.0889363617946235], [1393901328112, 2.0081293742436275], [1393901346112, 2.24387671219727], [1393901364112, 2.0964742702793338], [1393901382112, 1.8821914502086596], [1393901400112, 1.8990775026872782], [1393901418112, 1.7322873203115163], [1393901436112, 1.4964353107468453], [1393901454112, 1.547979584830327], [1393901472112, 1.5869208379280593], [1393901490112, 1.738976899076532], [1393901508112, 1.6077717259013562], [1393901526112, 1.8140481004873212], [1393901544112, 1.9094655908038114], [1393901562112, 2.072530259874533], [1393901580112, 2.0988148330000693], [1393901598112, 2.1135532202663105], [1393901616112, 1.9316322321841384], [1393901634112, 2.086023799477557], [1393901652112, 2.1731050170754473], [1393901670112, 2.1245176398865775], [1393901688112, 2.368434631137048], [1393901706112, 2.5148877670025964], [1393901724112, 2.2857226754295286], [1393901742112, 2.23662229588234], [1393901760112, 2.2827263517381953], [1393901778112, 2.301091231115369], [1393901796112, 2.391781195232913], [1393901814112, 2.1942349997451633], [1393901832112, 2.348091044265562], [1393901850112, 2.5012934821485353], [1393901868112, 2.6350928212093634], [1393901886112, 2.720993897990539], [1393901904112, 2.952941095971024], [1393901922112, 3.090052173771563], [1393901940112, 3.1301738535558568], [1393901958112, 2.9058902548569483], [1393901976112, 2.808464144487608], [1393901994112, 2.633559231577001], [1393902012112, 2.564221564585928], [1393902030112, 2.4823154671755443], [1393902048112, 2.433410027409867], [1393902066112, 2.4052135714720895], [1393902084112, 2.4745627315976844], [1393902102112, 2.3034310345549094], [1393902120112, 2.141344360657264], [1393902138112, 1.9861394933425656], [1393902156112, 2.129486976098901]], [[1393898556112, 0], [1393898574112, 0.0], [1393898592112, 5.714932046107935], [1393898610112, 0.0], [1393898628112, 0.0], [1393898646112, 12.981396020864164], [1393898664112, 0.0], [1393898682112, 7.146493491271333], [1393898700112, 9.531338066893948], [1393898718112, 14.696956953873872], [1393898736112, 0.0], [1393898754112, 14.196487534115201], [1393898772112, 19.848269622470717], [1393898790112, 37.56124364202768], [1393898808112, 55.67838809630611], [1393898826112, 29.15157303105745], [1393898844112, 0.17174248930219285], [1393898862112, 25.736773390290054], [1393898880112, 22.334650020272424], [1393898898112, 34.88583318480208], [1393898916112, 34.36029073522609], [1393898934112, 15.117568062860782], [1393898952112, 0.0], [1393898970112, 24.082742306648846], [1393898988112, 0.4021837708486746], [1393899006112, 14.91850790103591], [1393899024112, 0.0], [1393899042112, 2.4582514732999723], [1393899060112, 0.0], [1393899078112, 0.0], [1393899096112, 16.309172335307604], [1393899114112, 17.63261323300716], [1393899132112, 20.786370108498488], [1393899150112, 5.22761345237757], [1393899168112, 0.0], [1393899186112, 8.777672678516925], [1393899204112, 24.155228794340644], [1393899222112, 44.66690323628371], [1393899240112, 73.9985061867845], [1393899258112, 47.11492898258101], [1393899276112, 31.099924280663146], [1393899294112, 32.619944002027125], [1393899312112, 52.106702577420755], [1393899330112, 39.713055618069426], [1393899348112, 64.57881194258489], [1393899366112, 92.94963016895822], [1393899384112, 113.18151893348254], [1393899402112, 85.5480114154677], [1393899420112, 111.26480814432415], [1393899438112, 101.21143456898592], [1393899456112, 84.6396200096593], [1393899474112, 77.76052136043715], [1393899492112, 52.87174498119175], [1393899510112, 55.77114100029515], [1393899528112, 83.9028498414095], [1393899546112, 111.8803447815339], [1393899564112, 106.35142361018377], [1393899582112, 126.16884554818157], [1393899600112, 111.1825760163812], [1393899618112, 140.1751416555672], [1393899636112, 168.63414523643894], [1393899654112, 150.72040947348455], [1393899672112, 138.5455607171404], [1393899690112, 140.7443886861978], [1393899708112, 151.17798917442056], [1393899726112, 137.045092127212], [1393899744112, 144.15938844189273], [1393899762112, 156.01278502031144], [1393899780112, 183.90745525177937], [1393899798112, 175.63101194555068], [1393899816112, 179.32945150339174], [1393899834112, 185.04983619477196], [1393899852112, 210.24384117787986], [1393899870112, 186.02640439218874], [1393899888112, 196.87289934132698], [1393899906112, 198.2784213842303], [1393899924112, 223.2811826623033], [1393899942112, 218.0075959620384], [1393899960112, 225.7550225115492], [1393899978112, 251.47962362477162], [1393899996112, 270.5187706272632], [1393900014112, 269.3785092910148], [1393900032112, 281.2111511698908], [1393900050112, 310.2830431477778], [1393900068112, 291.41934930487844], [1393900086112, 284.4309354843636], [1393900104112, 298.39264947908805], [1393900122112, 326.469468859655], [1393900140112, 313.47650221069443], [1393900158112, 290.6983657587378], [1393900176112, 306.9315089947838], [1393900194112, 295.4121164015766], [1393900212112, 279.5069128915424], [1393900230112, 279.94873777523986], [1393900248112, 296.21710786798735], [1393900266112, 290.89333839049823], [1393900284112, 272.56681406945324], [1393900302112, 251.59000100412456], [1393900320112, 281.4801414993051], [1393900338112, 278.7026283584495], [1393900356112, 307.3817243285788], [1393900374112, 287.5872366736775], [1393900392112, 271.43566123162265], [1393900410112, 254.27192956544744], [1393900428112, 251.9768036764693], [1393900446112, 265.27273687598205], [1393900464112, 290.8802518831467], [1393900482112, 309.7040105084753], [1393900500112, 300.79876983915705], [1393900518112, 289.7049413466404], [1393900536112, 290.1250019406799], [1393900554112, 298.95872818293384], [1393900572112, 278.8697155857261], [1393900590112, 285.36256644403545], [1393900608112, 289.2070830031526], [1393900626112, 293.02451436647806], [1393900644112, 265.75067003803264], [1393900662112, 290.10506139730455], [1393900680112, 277.4961043102419], [1393900698112, 256.36621206985313], [1393900716112, 238.4515234583032], [1393900734112, 239.92027857542422], [1393900752112, 252.61022403871243], [1393900770112, 268.66316181387646], [1393900788112, 241.6291203575049], [1393900806112, 220.44183343439943], [1393900824112, 229.52753005530224], [1393900842112, 246.08570828447895], [1393900860112, 266.98934012967635], [1393900878112, 265.26383132958455], [1393900896112, 257.5577811939758], [1393900914112, 276.1771529264704], [1393900932112, 274.8110604837082], [1393900950112, 280.6000517329589], [1393900968112, 256.7897013754223], [1393900986112, 229.3820295974662], [1393901004112, 248.21890179799848], [1393901022112, 232.85121197885275], [1393901040112, 235.15046460841188], [1393901058112, 224.73141847796393], [1393901076112, 220.07356676599258], [1393901094112, 206.13409802377117], [1393901112112, 210.19605240020275], [1393901130112, 224.32578953277215], [1393901148112, 213.51933773275326], [1393901166112, 232.79434620668226], [1393901184112, 257.4815925906455], [1393901202112, 254.08991364196885], [1393901220112, 263.23537733217705], [1393901238112, 286.28567234184146], [1393901256112, 266.5887268569772], [1393901274112, 246.012450430053], [1393901292112, 243.57575478466512], [1393901310112, 250.92808676598443], [1393901328112, 240.92082870915388], [1393901346112, 268.76725354193945], [1393901364112, 250.85704301811342], [1393901382112, 225.01222491328602], [1393901400112, 226.98825576669577], [1393901418112, 207.35756911202157], [1393901436112, 178.94881292192434], [1393901454112, 185.1251235493765], [1393901472112, 189.942114022356], [1393901490112, 208.3823384228657], [1393901508112, 192.61838057357838], [1393901526112, 217.69674009119754], [1393901544112, 229.57672154045434], [1393901562112, 249.60505535022634], [1393901580112, 252.24687529511036], [1393901598112, 254.35903813722928], [1393901616112, 232.78590382834713], [1393901634112, 251.69981638758594], [1393901652112, 262.4858089102551], [1393901670112, 256.1972116376131], [1393901688112, 285.9987597460641], [1393901706112, 303.4377071468899], [1393901724112, 275.49225895423103], [1393901742112, 270.04595964822056], [1393901760112, 276.180398112143], [1393901778112, 278.09534216716787], [1393901796112, 289.0131794104244], [1393901814112, 265.32626290937156], [1393901832112, 284.3367382320076], [1393901850112, 302.72855593909566], [1393901868112, 319.5625889417926], [1393901886112, 329.8870755965439], [1393901904112, 358.6380985988179], [1393901922112, 374.7834679147231], [1393901940112, 379.80993120025494], [1393901958112, 352.8339603784596], [1393901976112, 340.959903432395], [1393901994112, 320.26937447023846], [1393902012112, 311.7176588508914], [1393902030112, 302.02584660368433], [1393902048112, 296.53235291300024], [1393902066112, 292.9551639089509], [1393902084112, 301.34085657335623], [1393902102112, 280.3296276886723], [1393902120112, 260.6207874844655], [1393902138112, 241.28807656487967], [1393902156112, 258.8140791279292]]]'''

def application(environ, start_response):
	status = '200 OK'
	
	qs = environ['QUERY_STRING']
	
	query = {}
	
	if qs != "":
		for v in qs.split('&'):
			v = v.split('=')
			query[v[0]] = v[1]
	
	if environ['PATH_INFO'] == "/detail":
		data = get_data(query['id'])
		output = json.dumps(data)
		
	elif environ['PATH_INFO'] == "/devices":
		data = get_devices()
		output = json.dumps(data)
	else:
		output = json.dumps([environ,query], skipkeys=True, default=lambda obj: 'N/A')
	
	response_headers = [('Content-type', 'application/json'),
						('Content-Length', str(len(output))),
						('Access-Control-Allow-Origin', '*')]
	start_response(status, response_headers)
	
	return output
